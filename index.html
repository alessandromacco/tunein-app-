<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sacred Heart Temple - Tune In</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Tone.js for professional pitch-shifting -->
  <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Audio configuration
    const AUDIO_URL = 'https://tunein.b-cdn.net/Track.01.wav';
    const STANDARD_FREQ = 440; // A440 standard

    // Solfeggio frequencies with descriptions
    const FREQUENCIES = {
      396: { name: 'Muladhara', color: '#ef4444', desc: 'Grounding & Liberation' },
      417: { name: 'Svadhisthana', color: '#f59e0b', desc: 'Change & Transformation' },
      432: { name: 'Universal', color: '#10b981', desc: 'Universal Harmony' },
      440: { name: 'Standard', color: '#3b82f6', desc: 'Western Standard' },
      528: { name: 'Manipura', color: '#8b5cf6', desc: 'Love & Healing' },
      639: { name: 'Anahata', color: '#ec4899', desc: 'Connection & Relationships' },
      741: { name: 'Vishuddha', color: '#f97316', desc: 'Expression & Solutions' },
      852: { name: 'Ajna', color: '#06b6d4', desc: 'Intuition & Awareness' },
      963: { name: 'Sahasrara', color: '#a855f7', desc: 'Unity & Enlightenment' }
    };

    // Translations
    const TRANSLATIONS = {
      it: {
        title: 'Sacred Heart Temple',
        subtitle: 'Sintonizzati sulle frequenze di guarigione',
        presetMode: 'Frequenze Solfeggio',
        customMode: 'Frequenza Personalizzata',
        customFreq: 'Hz personalizzati (200-1000)',
        play: 'Riproduci',
        pause: 'Pausa',
        volume: 'Volume',
        info: 'Info frequenze',
        infoText: 'Le frequenze Solfeggio sono frequenze sonore specifiche che promuovono vari aspetti della salute fisica e spirituale. Ogni frequenza ha propriet√† uniche per il bilanciamento dei chakra e la guarigione.',
        noteTitle: 'üéØ Nota importante',
        noteText: 'Questo player genera frequenze pure matematicamente esatte usando Tone.js. Per ricevere i benefici completi, ascolta direttamente da questa pagina con cuffie di buona qualit√†. Lo streaming via OBS/YouTube comprime l\'audio e le frequenze non arrivano integre.',
        language: 'Lingua'
      },
      en: {
        title: 'Sacred Heart Temple',
        subtitle: 'Tune into healing frequencies',
        presetMode: 'Solfeggio Frequencies',
        customMode: 'Custom Frequency',
        customFreq: 'Custom Hz (200-1000)',
        play: 'Play',
        pause: 'Pause',
        volume: 'Volume',
        info: 'Frequency info',
        infoText: 'Solfeggio frequencies are specific sound frequencies that promote various aspects of physical and spiritual health. Each frequency has unique properties for chakra balancing and healing.',
        noteTitle: 'üéØ Important Note',
        noteText: 'This player generates mathematically precise pure frequencies using Tone.js. To receive the full benefits, listen directly from this page with good quality headphones. Streaming via OBS/YouTube compresses the audio and frequencies don\'t arrive intact.',
        language: 'Language'
      }
    };

    function TuneIn() {
      const [lang, setLang] = useState('it');
      const [selectedFreq, setSelectedFreq] = useState(432);
      const [customFreq, setCustomFreq] = useState(432);
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);
      const [volume, setVolume] = useState(0.7);
      const [isCustomMode, setIsCustomMode] = useState(false);
      const [showInfo, setShowInfo] = useState(false);

      // Refs for Tone.js
      const playerRef = useRef(null);
      const pitchShiftRef = useRef(null);
      const volumeNodeRef = useRef(null);
      const isInitializedRef = useRef(false);

      const t = TRANSLATIONS[lang];

      // Initialize Tone.js audio chain
      useEffect(() => {
        const initAudio = async () => {
          try {
            // Create player
            playerRef.current = new Tone.Player({
              url: AUDIO_URL,
              loop: true,
              onload: () => {
                setDuration(playerRef.current.buffer.duration);
                console.log('Audio loaded successfully');
              }
            });

            // Create pitch shift effect (preserves tempo)
            pitchShiftRef.current = new Tone.PitchShift({
              pitch: 0, // semitones
              windowSize: 0.1,
              delayTime: 0,
              feedback: 0
            });

            // Create volume node
            volumeNodeRef.current = new Tone.Volume(-10); // start at 70% volume

            // Connect audio chain: Player -> PitchShift -> Volume -> Destination
            playerRef.current.chain(
              pitchShiftRef.current,
              volumeNodeRef.current,
              Tone.Destination
            );

            isInitializedRef.current = true;

            // Update time periodically
            const interval = setInterval(() => {
              if (playerRef.current && playerRef.current.state === 'started') {
                setCurrentTime(playerRef.current.buffer.duration * (Tone.Transport.seconds % playerRef.current.buffer.duration) / playerRef.current.buffer.duration);
              }
            }, 100);

            return () => clearInterval(interval);
          } catch (error) {
            console.error('Error initializing audio:', error);
          }
        };

        initAudio();

        // Cleanup
        return () => {
          if (playerRef.current) {
            playerRef.current.stop();
            playerRef.current.dispose();
          }
          if (pitchShiftRef.current) {
            pitchShiftRef.current.dispose();
          }
          if (volumeNodeRef.current) {
            volumeNodeRef.current.dispose();
          }
        };
      }, []);

      // Update pitch when frequency changes
      useEffect(() => {
        if (!pitchShiftRef.current) return;

        const targetFreq = isCustomMode ? customFreq : selectedFreq;
        
        // Convert frequency ratio to semitones
        // semitones = 12 * log2(targetFreq / STANDARD_FREQ)
        const semitones = 12 * Math.log2(targetFreq / STANDARD_FREQ);
        
        pitchShiftRef.current.pitch = semitones;
        console.log(`Frequency: ${targetFreq}Hz, Semitones: ${semitones.toFixed(2)}`);
      }, [selectedFreq, customFreq, isCustomMode]);

      // Update volume
      useEffect(() => {
        if (!volumeNodeRef.current) return;
        
        // Convert 0-1 range to decibels (-60 to 0)
        const db = volume === 0 ? -Infinity : 20 * Math.log10(volume);
        volumeNodeRef.current.volume.value = db;
      }, [volume]);

      // Play/Pause handler
      const handlePlayPause = async () => {
        if (!isInitializedRef.current) return;

        try {
          // Start Tone.js audio context
          await Tone.start();
          
          if (isPlaying) {
            playerRef.current.stop();
            Tone.Transport.stop();
            setIsPlaying(false);
          } else {
            Tone.Transport.start();
            playerRef.current.start();
            setIsPlaying(true);
          }
        } catch (error) {
          console.error('Error playing audio:', error);
        }
      };

      // Seek handler
      const handleSeek = (e) => {
        if (!playerRef.current || !duration) return;
        
        const seekTime = (e.target.value / 100) * duration;
        playerRef.current.seek(seekTime);
        setCurrentTime(seekTime);
      };

      // Format time helper
      const formatTime = (seconds) => {
        if (!seconds || isNaN(seconds)) return '0:00';
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const currentFreq = isCustomMode ? customFreq : selectedFreq;
      const freqData = FREQUENCIES[currentFreq] || FREQUENCIES[432];

      return (
        <div className="min-h-screen bg-gradient-to-br from-indigo-950 via-purple-950 to-pink-950 text-white p-4 md:p-8">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8">
              <h1 className="text-4xl md:text-6xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                {t.title}
              </h1>
              <p className="text-gray-300 text-lg">{t.subtitle}</p>
              
              {/* Language Selector */}
              <div className="mt-4 flex justify-center gap-2">
                <button
                  onClick={() => setLang('it')}
                  className={`px-4 py-2 rounded-lg transition ${
                    lang === 'it' ? 'bg-purple-600' : 'bg-purple-900/50 hover:bg-purple-800/50'
                  }`}
                >
                  üáÆüáπ Italiano
                </button>
                <button
                  onClick={() => setLang('en')}
                  className={`px-4 py-2 rounded-lg transition ${
                    lang === 'en' ? 'bg-purple-600' : 'bg-purple-900/50 hover:bg-purple-800/50'
                  }`}
                >
                  üá¨üáß English
                </button>
              </div>
            </div>

            {/* Important Note */}
            <div className="mb-8 p-6 bg-yellow-900/30 border-2 border-yellow-600/50 rounded-xl backdrop-blur-sm">
              <h3 className="text-xl font-bold mb-2 text-yellow-300">{t.noteTitle}</h3>
              <p className="text-yellow-100/90 leading-relaxed">{t.noteText}</p>
            </div>

            {/* Mode Toggle */}
            <div className="mb-6 flex justify-center gap-4">
              <button
                onClick={() => setIsCustomMode(false)}
                className={`px-6 py-3 rounded-lg font-semibold transition ${
                  !isCustomMode ? 'bg-purple-600' : 'bg-purple-900/50 hover:bg-purple-800/50'
                }`}
              >
                {t.presetMode}
              </button>
              <button
                onClick={() => setIsCustomMode(true)}
                className={`px-6 py-3 rounded-lg font-semibold transition ${
                  isCustomMode ? 'bg-purple-600' : 'bg-purple-900/50 hover:bg-purple-800/50'
                }`}
              >
                {t.customMode}
              </button>
            </div>

            {/* Player Card */}
            <div className="bg-white/10 backdrop-blur-md rounded-2xl p-8 shadow-2xl border border-white/20">
              {/* Current Frequency Display */}
              <div className="text-center mb-8">
                <div 
                  className="text-8xl font-bold mb-2"
                  style={{ color: freqData.color }}
                >
                  {currentFreq}
                  <span className="text-4xl ml-2">Hz</span>
                </div>
                <div className="text-2xl font-semibold text-gray-300">{freqData.name}</div>
                <div className="text-lg text-gray-400 mt-1">{freqData.desc}</div>
              </div>

              {/* Frequency Selection */}
              {!isCustomMode ? (
                <div className="grid grid-cols-3 md:grid-cols-5 gap-3 mb-8">
                  {Object.entries(FREQUENCIES).map(([freq, data]) => (
                    <button
                      key={freq}
                      onClick={() => setSelectedFreq(Number(freq))}
                      className={`p-4 rounded-xl font-bold text-lg transition transform hover:scale-105 ${
                        selectedFreq === Number(freq)
                          ? 'ring-4 ring-white shadow-lg'
                          : 'opacity-60 hover:opacity-100'
                      }`}
                      style={{ 
                        backgroundColor: data.color,
                        color: 'white'
                      }}
                    >
                      {freq}
                    </button>
                  ))}
                </div>
              ) : (
                <div className="mb-8">
                  <label className="block text-center mb-4 text-lg font-semibold">
                    {t.customFreq}
                  </label>
                  <input
                    type="range"
                    min="200"
                    max="1000"
                    value={customFreq}
                    onChange={(e) => setCustomFreq(Number(e.target.value))}
                    className="w-full h-3 rounded-lg appearance-none cursor-pointer"
                    style={{
                      background: `linear-gradient(to right, ${freqData.color} 0%, ${freqData.color} ${((customFreq - 200) / 800) * 100}%, rgba(255,255,255,0.2) ${((customFreq - 200) / 800) * 100}%, rgba(255,255,255,0.2) 100%)`
                    }}
                  />
                  <div className="text-center mt-2 text-sm text-gray-400">200 Hz - 1000 Hz</div>
                </div>
              )}

              {/* Play/Pause Button */}
              <div className="flex justify-center mb-8">
                <button
                  onClick={handlePlayPause}
                  className="w-24 h-24 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 transition shadow-2xl flex items-center justify-center text-4xl transform hover:scale-105"
                >
                  {isPlaying ? '‚è∏' : '‚ñ∂'}
                </button>
              </div>

              {/* Progress Bar */}
              <div className="mb-6">
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={duration ? (currentTime / duration) * 100 : 0}
                  onChange={handleSeek}
                  className="w-full h-2 rounded-lg appearance-none cursor-pointer bg-white/20"
                />
                <div className="flex justify-between text-sm text-gray-400 mt-2">
                  <span>{formatTime(currentTime)}</span>
                  <span>{formatTime(duration)}</span>
                </div>
              </div>

              {/* Volume Control */}
              <div className="mb-6">
                <label className="block text-center mb-2 text-sm font-semibold">
                  {t.volume}: {Math.round(volume * 100)}%
                </label>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={volume * 100}
                  onChange={(e) => setVolume(Number(e.target.value) / 100)}
                  className="w-full h-2 rounded-lg appearance-none cursor-pointer"
                  style={{
                    background: `linear-gradient(to right, ${freqData.color} 0%, ${freqData.color} ${volume * 100}%, rgba(255,255,255,0.2) ${volume * 100}%, rgba(255,255,255,0.2) 100%)`
                  }}
                />
              </div>

              {/* Info Button */}
              <div className="text-center">
                <button
                  onClick={() => setShowInfo(!showInfo)}
                  className="px-6 py-3 bg-white/10 hover:bg-white/20 rounded-lg transition backdrop-blur-sm"
                >
                  {t.info} {showInfo ? '‚ñ≤' : '‚ñº'}
                </button>
              </div>

              {/* Info Panel */}
              {showInfo && (
                <div className="mt-6 p-6 bg-white/5 rounded-xl backdrop-blur-sm border border-white/10">
                  <p className="text-gray-300 leading-relaxed">{t.infoText}</p>
                  <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                    {Object.entries(FREQUENCIES).map(([freq, data]) => (
                      <div key={freq} className="flex items-center gap-3">
                        <div 
                          className="w-4 h-4 rounded-full flex-shrink-0"
                          style={{ backgroundColor: data.color }}
                        />
                        <div>
                          <span className="font-bold">{freq} Hz</span> - {data.desc}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* Footer */}
            <div className="text-center mt-8 text-gray-400 text-sm">
              <p>üéµ Powered by Tone.js ‚Ä¢ Pure Frequencies ‚Ä¢ Tempo Preserved üéµ</p>
              <p className="mt-2">Sacred Heart Temple ¬© 2025</p>
            </div>
          </div>
        </div>
      );
    }

    // Render app
    ReactDOM.render(<TuneIn />, document.getElementById('root'));
  </script>
</body>
</html>
